YUI.add("moodle-enrol_coursepayment-rearrange",function(r,t){var s=function(){s.superclass.constructor.apply(this,[arguments])};r.extend(s,r.Base,{templateid:0,page:[],elements:[],pdfx:0,pdfy:0,pdfwidth:0,pdfheight:0,elementxy:0,pdfleftboundary:0,pdfrightboundary:0,pixelsinmm:3.779527559055,initializer:function(t){this.templateid=t[0],this.page=t[1],this.elements=t[2],this.pdfx=r.one("#pdf").getX(),this.pdfy=r.one("#pdf").getY(),this.pdfwidth=parseFloat(r.one("#pdf").getComputedStyle("width")),this.pdfheight=parseFloat(r.one("#pdf").getComputedStyle("height")),this.pdfleftboundary=this.pdfx,this.page.leftmargin&&(this.pdfleftboundary+=parseInt(this.page.leftmargin*this.pixelsinmm,10)),this.pdfrightboundary=this.pdfx+this.pdfwidth,this.page.rightmargin&&(this.pdfrightboundary-=parseInt(this.page.rightmargin*this.pixelsinmm,10)),this.setpositions(),this.createevents()},setpositions:function(){var t,e,i,s,n,a;for(t in this.elements){switch(e=this.elements[t],i=this.pdfx+e.posx*this.pixelsinmm,s=this.pdfy+e.posy*this.pixelsinmm,n=parseFloat(r.one("#element-"+e.id).getComputedStyle("width")),(a=e.width*this.pixelsinmm)&&a<n&&(n=a),e.refpoint){case"1":i-=n/2;break;case"2":i=i-n+2}r.one("#element-"+e.id).setX(i),r.one("#element-"+e.id).setY(s)}},createevents:function(){r.one(".savepositionsbtn [type=submit]").on("click",function(t){this.savepositions(t)},this),r.one(".applypositionsbtn [type=submit]").on("click",function(t){this.savepositions(t),t.preventDefault()},this);var e=new r.DD.Delegate({container:"#pdf",nodes:".element"});e.on("drag:start",function(){var t=e.get("currentNode");this.elementxy=t.getXY()},this),e.on("drag:end",function(){var t=e.get("currentNode");this.isoutofbounds(t)&&t.setXY(this.elementxy)},this)},isoutofbounds:function(t){var e=parseFloat(t.getComputedStyle("width")),i=parseFloat(t.getComputedStyle("height")),s=t.getX(),e=s+e,t=t.getY(),i=t+i;return s<this.pdfleftboundary||e>this.pdfrightboundary||(t<this.pdfy||i>this.pdfy+this.pdfheight)},savepositions:function(s){var t,e,i,n,a,o,p,d={tid:this.templateid,action:"update_invoice_element",sesskey:M.cfg.sesskey,courseid:1,data:[]};for(t in this.elements){switch(e=this.elements[t],n=(i=r.one("#element-"+e.id)).getX()-this.pdfx,a=i.getY()-this.pdfy,o=i.getData("refpoint"),p=parseFloat(i.getComputedStyle("width")),o){case"1":n+=p/2;break;case"2":n+=p}d.data.push({id:e.id,posx:Math.round(parseFloat(n/this.pixelsinmm)),posy:Math.round(parseFloat(a/this.pixelsinmm))})}d.data=JSON.stringify(d.data),r.io(M.cfg.wwwroot+"/enrol/coursepayment/ajax.php",{method:"POST",data:d,on:{failure:function(t,e){this.ajaxfailure(e)},success:function(){var t=s.currentTarget.ancestor("form",!0),e=t.getAttribute("action"),i=t.one("[name=pid]");i?(i=i.get("value"),window.location=e+"?pid="+i):(i=t.one("[name=tid]").get("value"),window.location=e+"?tid="+i)}},context:this}),s.preventDefault()},ajaxfailure:function(t){t={name:t.status+" "+t.statusText,message:t.responseText};return new M.core.exception(t)}}),r.namespace("M.enrol_coursepayment.rearrange").init=function(t,e,i){new s(t,e,i)}},"@VERSION@",{requires:["dd-delegate","dd-drag"]});